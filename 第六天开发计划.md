# 第六天开发计划 - 学习与管理功能

**计划日期**: 2025年10月24日  
**开发者**: David  
**任务优先级**: 🟡 中等  
**预计工时**: 10 小时

---

## 📋 任务概览

第六天主要开发**学习与管理功能模块**，包括标签管理、书签收藏、系统设置和任务管理四个页面。这些功能将帮助用户更好地组织和管理自己的棋局数据。

---

## 🎯 具体任务

### 1. 标签管理功能 (3小时)

#### 1.1 后端开发 (1.5小时)

**数据库表**: `tags` (已存在)
- id: BIGINT (主键)
- user_id: BIGINT (用户ID)
- tag_name: VARCHAR(50) (标签名称)
- tag_color: VARCHAR(20) (标签颜色)
- description: VARCHAR(200) (描述)
- game_count: INT (关联棋局数)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP

**关联表**: `game_tags` (已存在)
- id: BIGINT (主键)
- game_id: BIGINT (棋局ID)
- tag_id: BIGINT (标签ID)
- created_at: TIMESTAMP

**需要创建的类**:
1. `TagsController` - REST API 控制器
   - `GET /api/tags` - 获取用户所有标签
   - `POST /api/tags` - 创建新标签
   - `PUT /api/tags/{id}` - 更新标签
   - `DELETE /api/tags/{id}` - 删除标签
   - `GET /api/tags/{id}/games` - 获取标签关联的棋局
   - `POST /api/games/{gameId}/tags` - 为棋局添加标签
   - `DELETE /api/games/{gameId}/tags/{tagId}` - 移除棋局标签

2. `TagsService` - 业务逻辑层
   - 标签 CRUD 操作
   - 标签与棋局关联管理
   - 标签使用统计

3. DTO 类:
   - `TagDTO` - 标签数据传输对象
   - `CreateTagRequest` - 创建标签请求
   - `UpdateTagRequest` - 更新标签请求
   - `TagWithGamesDTO` - 标签及关联棋局

#### 1.2 前端开发 (1.5小时)

**页面**: `tags.html`

**功能模块**:
1. **标签列表展示**
   - 卡片式布局
   - 显示标签名称、颜色、描述、关联棋局数
   - 按创建时间/使用次数排序

2. **标签创建**
   - 模态框表单
   - 输入：名称、颜色选择器、描述
   - 表单验证

3. **标签编辑**
   - 内联编辑或模态框
   - 支持修改名称、颜色、描述

4. **标签删除**
   - 确认对话框
   - 显示关联棋局数量警告

5. **标签详情**
   - 点击标签查看关联的所有棋局
   - 支持从标签中移除棋局

**UI 设计**:
- 配色方案：支持8-10种预设颜色
- 响应式布局
- 平滑动画效果

---

### 2. 书签收藏功能 (2小时)

#### 2.1 后端开发 (1小时)

**数据库表**: `bookmarks` (已存在)
- id: BIGINT (主键)
- user_id: BIGINT (用户ID)
- game_id: BIGINT (棋局ID)
- move_number: INT (收藏的步数)
- position_fen: VARCHAR(200) (局面FEN)
- note: TEXT (备注)
- bookmark_type: VARCHAR(20) (类型: critical/interesting/learning)
- created_at: TIMESTAMP

**需要创建的类**:
1. `BookmarksController` - REST API 控制器
   - `GET /api/bookmarks` - 获取用户所有书签
   - `POST /api/bookmarks` - 创建书签
   - `PUT /api/bookmarks/{id}` - 更新书签备注
   - `DELETE /api/bookmarks/{id}` - 删除书签
   - `GET /api/bookmarks/types/{type}` - 按类型筛选

2. `BookmarksService` - 业务逻辑层
   - 书签 CRUD 操作
   - FEN 位置验证
   - 按类型/时间筛选

3. DTO 类:
   - `BookmarkDTO` - 书签数据传输对象
   - `CreateBookmarkRequest` - 创建书签请求
   - `BookmarkWithGameDTO` - 书签及关联棋局信息

#### 2.2 前端开发 (1小时)

**页面**: `bookmarks.html`

**功能模块**:
1. **书签列表**
   - 时间线布局
   - 显示：棋局信息、步数、局面图、备注
   - 按类型/时间筛选

2. **书签创建**
   - 从棋局分析页面添加（需要在 dashboard.html 中集成）
   - 输入：类型、备注

3. **书签管理**
   - 编辑备注
   - 删除书签
   - 跳转到对应棋局和步数

4. **棋盘预览**
   - 使用 chessboard.js 显示局面
   - 支持点击放大查看

---

### 3. 系统设置功能 (2小时)

#### 3.1 后端开发 (1小时)

**数据库表**: `user_settings` (已存在)
- id: BIGINT (主键)
- user_id: BIGINT (用户ID)
- theme: VARCHAR(20) (主题: light/dark)
- language: VARCHAR(10) (语言: zh-CN/en-US)
- board_theme: VARCHAR(50) (棋盘主题)
- piece_set: VARCHAR(50) (棋子样式)
- analysis_depth: INT (分析深度)
- engine_threads: INT (引擎线程数)
- notifications_enabled: BOOLEAN (通知开关)
- auto_analyze: BOOLEAN (自动分析)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP

**需要创建的类**:
1. `SettingsController` - REST API 控制器
   - `GET /api/settings` - 获取用户设置
   - `PUT /api/settings` - 更新设置
   - `POST /api/settings/reset` - 重置为默认设置

2. `SettingsService` - 业务逻辑层
   - 设置读取和更新
   - 默认设置管理
   - 设置验证

3. DTO 类:
   - `UserSettingsDTO` - 用户设置数据传输对象
   - `UpdateSettingsRequest` - 更新设置请求

#### 3.2 前端开发 (1小时)

**页面**: `settings.html`

**功能模块**:
1. **界面设置**
   - 主题切换 (浅色/深色)
   - 语言选择
   - 棋盘主题选择 (预览)
   - 棋子样式选择 (预览)

2. **分析设置**
   - 默认分析深度 (滑块: 10-30)
   - 引擎线程数 (1-8)
   - 自动分析开关

3. **通知设置**
   - 通知开关
   - 邮件通知偏好

4. **账户管理**
   - 修改密码
   - 数据导出
   - 清空数据 (危险操作)

5. **其他**
   - 重置为默认设置
   - 保存按钮

---

### 4. 任务管理功能 (1小时)

#### 4.1 后端开发 (0.5小时)

**数据库表**: `tasks` (已存在)
- id: BIGINT (主键)
- user_id: BIGINT (用户ID)
- task_title: VARCHAR(200) (任务标题)
- task_type: VARCHAR(50) (类型: study_opening/analyze_game/practice)
- priority: VARCHAR(20) (优先级: high/medium/low)
- status: VARCHAR(20) (状态: pending/in_progress/completed)
- related_game_id: BIGINT (关联棋局ID, 可为空)
- target_date: DATE (目标日期)
- description: TEXT (描述)
- created_at: TIMESTAMP
- completed_at: TIMESTAMP

**需要创建的类**:
1. `TasksController` - REST API 控制器
   - `GET /api/tasks` - 获取任务列表
   - `POST /api/tasks` - 创建任务
   - `PUT /api/tasks/{id}` - 更新任务
   - `DELETE /api/tasks/{id}` - 删除任务
   - `PUT /api/tasks/{id}/status` - 更新任务状态
   - `GET /api/tasks/statistics` - 任务统计

2. `TasksService` - 业务逻辑层
   - 任务 CRUD
   - 任务状态流转
   - 任务统计

3. DTO 类:
   - `TaskDTO` - 任务数据传输对象
   - `CreateTaskRequest` - 创建任务请求
   - `TaskStatisticsDTO` - 任务统计

#### 4.2 前端开发 (0.5小时)

**页面**: `tasks.html`

**功能模块**:
1. **任务看板**
   - 三列布局: 待办 / 进行中 / 已完成
   - 拖拽排序 (可选)

2. **任务创建**
   - 快速添加
   - 详细表单：标题、类型、优先级、目标日期、描述

3. **任务管理**
   - 标记完成/未完成
   - 编辑任务
   - 删除任务
   - 关联棋局链接

4. **任务统计**
   - 今日任务数
   - 本周完成率
   - 优先级分布

---

## 🔗 导航整合 (0.5小时)

需要在现有页面中添加导航链接：

1. **dashboard.html** - 添加到主菜单
2. **index.html** - 添加快捷入口
3. 所有新页面 - 统一导航栏

---

## 📊 开发顺序

建议按以下顺序开发（从简单到复杂）：

1. ✅ **任务管理** (1h) - 最简单，数据结构清晰
2. ✅ **系统设置** (2h) - 单表操作，UI相对简单
3. ✅ **书签收藏** (2h) - 需要FEN处理和棋盘显示
4. ✅ **标签管理** (3h) - 最复杂，涉及多对多关系

**预留时间**: 2小时用于调试、测试和文档编写

---

## 🎨 UI/UX 设计原则

1. **一致性**: 与现有页面保持相同的设计风格
2. **响应式**: 支持桌面和移动端
3. **反馈**: 操作后及时反馈（成功/失败提示）
4. **验证**: 前端表单验证 + 后端数据验证
5. **易用性**: 常用操作不超过3次点击

---

## 🧪 测试要点

### 后端测试
- [ ] API 端点可访问性
- [ ] 请求参数验证
- [ ] 数据库操作正确性
- [ ] 错误处理

### 前端测试
- [ ] 页面加载正常
- [ ] CRUD 操作流畅
- [ ] 表单验证有效
- [ ] 数据刷新及时
- [ ] 错误提示友好

### 集成测试
- [ ] 标签与棋局关联
- [ ] 书签跳转到棋局
- [ ] 任务关联棋局链接
- [ ] 设置实时生效

---

## 📦 技术栈

**后端**:
- Spring Boot 3.5.6
- Spring Data JPA
- MySQL 8.x
- JWT 认证

**前端**:
- Vue.js 3
- ECharts (任务统计图)
- Chess.js + Chessboard.js (书签棋盘)
- 原生 CSS

---

## 🎯 成功标准

1. ✅ 所有 API 端点正常工作
2. ✅ 前端页面美观实用
3. ✅ CRUD 操作流畅无误
4. ✅ 数据关联正确
5. ✅ 无明显 Bug
6. ✅ 代码规范整洁
7. ✅ 文档完整清晰

---

**计划创建时间**: 2025年10月24日 22:10  
**预期完成时间**: 2025年10月24日 深夜或次日

让我们开始吧！💪
