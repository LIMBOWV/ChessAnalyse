# Stockfish 国际象棋分析系统 - 毕业设计开发计划书

**项目名称**: Stockfish 国际象棋复盘分析系统（Project Zeus）  
**学生**: David  
**完成期限**: 2025年10月末前完成开发，2025年11月答辩  
**指导要求**: 至少 8 个数据库表 + 15 个前端页面  
**设计侧重**: 功能广度优先，技术深度已足够

---

## 📊 项目当前状态

### 已完成（MVP）
- ✅ 核心功能框架（Spring Boot + Stockfish + Vue 3）
- ✅ 3 个数据库表（user、game_pgn、analysis_result）
- ✅ 3 个前端页面（上传、列表、复盘/分析）
- ✅ 启发式走法分类算法
- ✅ 异步分析架构

### 需要完成
- 🚧 5 个新数据库表（开局库、用户统计、标签系统、书签等）
- 🚧 12 个新前端页面（认证、Dashboard、分析、管理等）

---

## 🗂️ 数据库扩展方案（8表总体）

### 已有表（3个）✅
1. **tbl_user** - 用户表（id, username, email, password_hash, created_at）
2. **tbl_game_pgn** - 棋局表（id, user_id, pgn_content, white_name, black_name, analysis_status）
3. **tbl_analysis_result** - 分析结果表（id, game_id, move_number, score, best_move, classification）

### 新增表（5个）🚧

#### 表4：tbl_opening_book - 开局库表
```sql
CREATE TABLE tbl_opening_book (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  eco_code VARCHAR(10) UNIQUE,           -- 如 "C50"
  opening_name VARCHAR(100) NOT NULL,   -- 如 "Italian Game"
  variation_name VARCHAR(100),          -- 如 "Giuoco Piano"
  moves_uci TEXT,                       -- UCI格式走法序列
  moves_san TEXT,                       -- SAN格式走法序列
  fen_position VARCHAR(100),            -- 开局后局面FEN
  popularity INT DEFAULT 0,             -- 使用频率排序
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_eco (eco_code),
  INDEX idx_opening_name (opening_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 表5：tbl_user_statistics - 用户统计表
```sql
CREATE TABLE tbl_user_statistics (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL UNIQUE,
  total_games INT DEFAULT 0,
  win_count INT DEFAULT 0,
  draw_count INT DEFAULT 0,
  loss_count INT DEFAULT 0,
  avg_accuracy DECIMAL(5,2) DEFAULT 0.00,  -- 平均准确度 %
  total_brilliants INT DEFAULT 0,
  total_goods INT DEFAULT 0,
  total_mistakes INT DEFAULT 0,
  total_blunders INT DEFAULT 0,
  favorite_opening_id BIGINT,              -- 最擅长开局
  last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES tbl_user(id) ON DELETE CASCADE,
  FOREIGN KEY (favorite_opening_id) REFERENCES tbl_opening_book(id),
  INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 表6：tbl_game_tag - 棋局标签表
```sql
CREATE TABLE tbl_game_tag (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  tag_name VARCHAR(50) NOT NULL,         -- 标签名称
  tag_color VARCHAR(10) DEFAULT '#667eea',  -- 标签颜色（hex）
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES tbl_user(id) ON DELETE CASCADE,
  UNIQUE KEY unique_user_tag (user_id, tag_name),
  INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 表7：tbl_game_tag_relation - 棋局标签关联表（多对多）
```sql
CREATE TABLE tbl_game_tag_relation (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  game_id BIGINT NOT NULL,
  tag_id BIGINT NOT NULL,
  FOREIGN KEY (game_id) REFERENCES tbl_game_pgn(id) ON DELETE CASCADE,
  FOREIGN KEY (tag_id) REFERENCES tbl_game_tag(id) ON DELETE CASCADE,
  UNIQUE KEY unique_game_tag (game_id, tag_id),
  INDEX idx_game_id (game_id),
  INDEX idx_tag_id (tag_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 表8：tbl_position_bookmark - 局面书签表
```sql
CREATE TABLE tbl_position_bookmark (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  game_id BIGINT NOT NULL,
  user_id BIGINT NOT NULL,
  move_number INT NOT NULL,             -- 收藏的步数
  fen_position VARCHAR(100) NOT NULL,   -- 局面FEN
  note TEXT,                            -- 用户备注
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (game_id) REFERENCES tbl_game_pgn(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES tbl_user(id) ON DELETE CASCADE,
  INDEX idx_game_id (game_id),
  INDEX idx_user_id (user_id),
  INDEX idx_move_number (move_number)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

---

## 🖥️ 前端页面扩展方案（15页面总体）

### 已有页面（3个）✅
1. **PGN 上传页** (`/upload`) - 拖放/选择/粘贴上传
2. **棋局列表页** (`/games`) - 展示用户所有棋局
3. **复盘分析页** (`/game/:id`) - 棋盘交互 + 走法分析

### 新增页面（12个）🚧

#### 模块 A：用户认证系统（3 页）| 优先级：🔴 最高
**预计工时**: 6 小时

##### 页面 4：用户注册页 (`/register`)
- 表单字段：用户名、邮箱、密码、确认密码
- 功能：实时验证、密码强度提示、重复邮箱检测
- 后端 API：`POST /api/auth/register`
- 提交后自动跳转到登录页

##### 页面 5：用户登录页 (`/login`)
- 表单字段：邮箱/用户名、密码
- 功能：记住登录状态（LocalStorage 存储 JWT Token）
- 后端 API：`POST /api/auth/login` → 返回 JWT Token
- 登录后重定向到首页或棋局列表

##### 页面 6：个人中心页 (`/profile`)
- 展示用户信息（用户名、邮箱、加入时间）
- 快速统计（总棋局数、胜率、精准度）
- 功能：修改密码、修改头像（可选）、账号设置
- 后端 API：`GET /api/user/profile`、`PUT /api/user/profile`

---

#### 模块 B：数据分析系统（5 页）| 优先级：🔴 最高
**预计工时**: 20 小时

##### 页面 7：用户统计 Dashboard (`/dashboard`)
- **布局**：卡片式仪表板
- **图表组件**：
  - 胜率饼图（赢/平/负）
  - 精准度趋势折线图（过去 30 天）
  - 走法分类柱状图（妙手/好棋/失误/漏着数量）
  - 对局数量卡片（总数、本月、本周）
- 使用 ECharts 实现
- 后端 API：`GET /api/statistics/{userId}`

##### 页面 8：开局分析页 (`/openings`)
- **表格展示**：
  - 所有开局列表（从 tbl_opening_book）
  - 列：开局代码、开局名称、变种、你的胜率、对局数、排名
- **功能**：按胜率/频率排序、点击查看详细走法
- **推荐卡片**：擅长的开局 Top 3、薄弱的开局 Top 3
- 后端 API：`GET /api/openings/stats/{userId}`

##### 页面 9：失误统计页 (`/mistakes`)
- **过滤器**：按失误等级（BLUNDER/MISTAKE/INACCURACY）、日期范围
- **列表**：失误棋局 - 对手、日期、失误步数、损失评分、原因
- **功能**：点击可跳转到该棋局的失误步骤进行复盘
- **热力图**：显示失误最多的开局阶段/棋子
- 后端 API：`GET /api/analysis/mistakes/{userId}?type=BLUNDER`

##### 页面 10：棋局对比分析页 (`/compare`)
- **选择棋局**：从列表中选择两个棋局
- **双棋盘并排显示**（使用两个 chessboard 实例）
- **评分曲线对比**：两条折线在同一图表上对比
- **关键差异点标注**：标出两局评分差异最大的步数
- **统计对比**：精准度、最佳走法准确率、失误数等
- 后端 API：`GET /api/analysis/compare/{gameId1}/{gameId2}`

##### 页面 11：历史趋势分析页 (`/trends`)
- **时间选择**：月度、季度、年度视图
- **多图表展示**：
  - 精准度趋势图
  - 胜率趋势图（每月胜负数）
  - 对局频率柱状图
  - 走法质量雷达图（各类走法占比）
- **关键指标卡**：当月最佳表现、最差表现、进步幅度
- 后端 API：`GET /api/statistics/trends/{userId}?period=month`

---

#### 模块 C：学习管理功能（2 页）| 优先级：🟠 中高
**预计工时**: 8 小时

##### 页面 12：局面收藏页 (`/bookmarks`)
- **收藏列表**：显示所有收藏的关键局面
- **缩略图**：棋盘快照 + 步数 + 备注
- **操作**：删除、编辑备注、跳转到原棋局
- **分类**：按棋局、按开局、按日期排序
- 后端 API：`GET /api/bookmarks/{userId}`、`DELETE /api/bookmarks/{id}`

##### 页面 13：标签管理页 (`/tags`)
- **标签列表**：所有用户创建的标签
- **标签操作**：创建、编辑颜色、删除、查看关联棋局数
- **标签云展示**：字体大小表示使用频率
- **快速筛选**：点击标签名查看关联的所有棋局
- 后端 API：`GET /api/tags/{userId}`、`POST /api/tags`、`DELETE /api/tags/{id}`

---

#### 模块 D：系统管理功能（2 页）| 优先级：🟡 中等
**预计工时**: 6 小时

##### 页面 14：系统设置页 (`/settings`)
- **Stockfish 引擎参数**：
  - 分析深度（8～20）
  - 分析时间（100～5000 毫秒）
  - 多线程数量
- **界面设置**：
  - 主题切换（亮色/暗色）
  - 棋盘样式选择（各种棋子/棋盘图案）
  - 语言选择（中文/English）
- **通知设置**：分析完成提醒、错误提醒
- 后端 API：`GET /api/settings/{userId}`、`PUT /api/settings/{userId}`

##### 页面 15：分析任务管理页 (`/tasks`)
- **任务列表**：显示所有分析任务状态
- **状态标签**：PENDING（等待中）、PROCESSING（分析中）、COMPLETED（已完成）、FAILED（失败）
- **操作**：查看进度、重试失败任务、取消进行中的任务
- **队列可视化**：显示任务队列长度和预计等待时间
- 后端 API：`GET /api/tasks/{userId}`、`POST /api/tasks/{taskId}/retry`

---

## 📅 开发时间规划（总计 7 天）

### 第一天（星期一）- 用户认证系统 🔴
- [ ] 创建 `tbl_user` 扩展字段（如需要）
- [ ] 开发后端 JWT 认证模块 (3h)
  - `POST /api/auth/register`
  - `POST /api/auth/login`
  - `GET /api/auth/profile`
- [ ] 前端实现：注册页、登录页、个人中心页 (3h)
- [ ] 集成测试 (1h)

**预计工时**: 7 小时

---

### 第二天（星期二）- 数据库与后端 API 🔴
- [ ] 创建 5 个新数据库表的 SQL 脚本 (2h)
  - 执行迁移脚本
  - 验证表结构
- [ ] 创建 Entity 和 Repository 类 (4h)
  - OpeningBook, UserStatistics, GameTag, etc.
  - 相应的 Repository 接口
- [ ] 创建基础 Service 类 (2h)

**预计工时**: 8 小时

---

### 第三天（星期三）- 分析数据 API 🔴
- [ ] 实现用户统计 API (3h)
  - `GET /api/statistics/{userId}`
  - 计算胜率、精准度、走法分类统计
- [ ] 实现开局分析 API (2h)
  - `GET /api/openings/stats/{userId}`
- [ ] 实现失误统计 API (2h)
  - `GET /api/analysis/mistakes/{userId}`
- [ ] 简单的缓存策略（可选）(1h)

**预计工时**: 8 小时

---

### 第四天（星期四）- Dashboard 与分析页面 🔴
- [ ] 前端 Dashboard 页面开发 (6h)
  - ECharts 集成（饼图、折线图、柱状图）
  - 数据绑定与实时更新
  - 响应式布局
- [ ] 前端开局分析页面 (2h)
- [ ] 前端失误统计页面 (2h)

**预计工时**: 10 小时

---

### 第五天（星期五）- 高级分析页面 🟠
- [ ] 前端对比分析页面 (4h)
  - 双棋盘并排显示
  - 评分曲线对比
- [ ] 前端历史趋势页面 (4h)
  - 多维数据可视化
  - 时间维度选择
- [ ] 后端支持 API (2h)

**预计工时**: 10 小时

---

### 第六天（星期六）- 学习与管理功能 🟡
- [ ] 前端标签管理页面 (3h)
- [ ] 前端局面收藏页面 (2h)
- [ ] 后端 API 实现 (2h)
  - Tags CRUD、Bookmarks CRUD
- [ ] 前端系统设置页面 (2h)
- [ ] 前端任务管理页面 (1h)

**预计工时**: 10 小时

---

### 第七天（星期日）- 测试与优化 🟡
- [ ] 全系统功能测试 (3h)
  - 用户认证流程
  - 数据统计准确性
  - 前端交互测试
- [ ] UI/UX 优化与响应式适配 (3h)
- [ ] Bug 修复与性能优化 (2h)
- [ ] 文档撰写与打包 (2h)

**预计工时**: 10 小时

---

## 🔗 后端 API 完整列表

### 认证模块
```
POST   /api/auth/register              # 注册
POST   /api/auth/login                 # 登录
GET    /api/auth/profile               # 获取个人资料
PUT    /api/auth/profile               # 更新个人资料
POST   /api/auth/change-password       # 修改密码
```

### 统计模块
```
GET    /api/statistics/{userId}        # 获取用户统计信息
GET    /api/statistics/openings/{userId}  # 开局统计
GET    /api/statistics/trends/{userId}    # 趋势数据（支持 ?period=month/quarter/year）
GET    /api/analysis/mistakes/{userId}    # 失误统计（支持 ?type=BLUNDER,MISTAKE）
GET    /api/analysis/compare/{gameId1}/{gameId2}  # 对比分析
```

### 标签模块
```
GET    /api/tags/{userId}              # 获取所有标签
POST   /api/tags                       # 创建标签
PUT    /api/tags/{tagId}               # 编辑标签
DELETE /api/tags/{tagId}               # 删除标签
POST   /api/games/{gameId}/tags/{tagId}       # 给棋局添加标签
DELETE /api/games/{gameId}/tags/{tagId}       # 移除棋局标签
```

### 书签模块
```
GET    /api/bookmarks/{userId}         # 获取书签列表
POST   /api/bookmarks                  # 创建书签
PUT    /api/bookmarks/{bookmarkId}     # 编辑书签
DELETE /api/bookmarks/{bookmarkId}     # 删除书签
```

### 开局库模块
```
GET    /api/openings                   # 获取所有开局
GET    /api/openings/detect/{gameId}   # 识别棋局开局
GET    /api/openings/{openingId}       # 获取开局详情
```

### 任务管理模块
```
GET    /api/tasks/{userId}             # 获取用户任务列表
POST   /api/tasks/{taskId}/retry       # 重试失败任务
DELETE /api/tasks/{taskId}             # 取消任务
```

### 设置模块
```
GET    /api/settings/{userId}          # 获取用户设置
PUT    /api/settings/{userId}          # 更新用户设置
```

---

## 📐 技术实现细节

### 后端技术栈
- **Framework**: Spring Boot 3.5.6
- **ORM**: Spring Data JPA + Hibernate
- **Database**: MySQL 8.x
- **Auth**: JWT (java-jwt 库)
- **Async**: Spring @Async + ThreadPoolExecutor
- **Cache**: 可选 Redis 或 Caffeine（优先级：低）

### 前端技术栈
- **Framework**: Vue 3 (Composition API)
- **Router**: Vue Router 4
- **State Management**: Pinia（如需要）
- **UI Components**: 自定义组件 + Element Plus（可选）
- **Charts**: ECharts 5.x
- **Chess Board**: chessboard.js + chess.js
- **HTTP**: Axios

### 数据库设计要点
- 所有新表使用 `utf8mb4` 字符集
- 外键约束使用 `ON DELETE CASCADE`
- 为高频查询字段添加索引
- 复合索引用于多字段查询（如 `(game_id, tag_id)`）

---

## 🎯 答辩准备要点

### 技术亮点展示
1. **核心创新**：自研启发式走法分类算法
2. **架构设计**：异步分析 + 结果缓存 + JWT 认证
3. **数据库设计**：8 表体现多种关系（一对多、多对多、统计聚合）
4. **全栈能力**：15 个页面涵盖各种前端技术（表单、图表、交互）
5. **实时分析**：Stockfish IPC + UCI 协议实现

### PPT 结构建议
1. **项目背景** - 为什么开发这个系统？
2. **系统架构** - 整体设计与技术选择
3. **数据库设计** - ER 图展示 8 表关系
4. **核心功能演示**
   - 棋谱上传与分析
   - 数据统计与可视化
   - 复盘与对比分析
5. **技术细节** - 代码示例（走法分类、异步分析）
6. **部署与总结**

### 演示脚本
```
1. 打开系统，展示用户界面
2. 上传一个 PGN 文件 → 后台异步分析
3. 查看分析结果 → 显示走法分类
4. 进入 Dashboard → 展示各类图表统计
5. 对比两个棋局 → 并排棋盘和曲线对比
6. 标签与收藏功能 → 个性化管理
```

---

## ⚠️ 风险与应对

### 时间风险
- **风险**：7 天完成 12 个页面 + 5 个表可能时间紧张
- **应对**：
  - 优先完成认证系统和 Dashboard（最能体现功能广度）
  - 后续页面使用通用组件快速搭建
  - 分工合作（如有队友）

### 技术风险
- **风险**：JWT 认证可能出现 Token 过期/刷新问题
- **应对**：提前实现 Token 刷新机制

- **风险**：ECharts 在大数据量下性能下降
- **应对**：限制初始数据量，提供时间范围筛选

### 数据一致性风险
- **风险**：用户统计数据可能不准确
- **应对**：使用触发器或定时任务实时更新统计表

---

## 📝 检查清单

### 提交前验证
- [ ] 所有 8 个数据库表已创建并通过测试
- [ ] 所有 15 个前端页面已实现
- [ ] 认证系统正常工作（注册、登录、Token 刷新）
- [ ] 数据统计结果准确
- [ ] 前端响应式布局适配移动设备
- [ ] 所有 API 已测试（可用 Postman）
- [ ] 单元测试覆盖核心逻辑
- [ ] 没有 JavaScript 控制台错误
- [ ] 代码注释完整
- [ ] README 文档已更新

### 答辩准备
- [ ] PPT 制作完成
- [ ] 演示脚本练习
- [ ] 源代码备份到 GitHub
- [ ] 系统可在本地运行演示
- [ ] 准备常见问题的回答

---

## 📞 重要联系和资源

### 相关文件
- 项目需求详解：`项目详细任务书.md`
- 项目架构说明：`CLAUDE.md`
- API 测试报告：`API_TEST_REPORT.md`
- 构建报告：`BUILD_REPORT.md`

### 外部资源
- Stockfish 文档：https://stockfishchess.org/
- Vue 3 官方文档：https://vuejs.org/
- ECharts 图表库：https://echarts.apache.org/
- Chess.js 库：https://github.com/jhlywa/chess.js

---

**文档最后更新**: 2025年10月23日  
**下一步行动**: 开始实施第一天的用户认证系统开发


